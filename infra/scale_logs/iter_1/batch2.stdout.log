:: loading settings :: url = jar:file:/opt/spark-3.5.0-bin-hadoop3/jars/ivy-2.5.1.jar!/org/apache/ivy/core/settings/ivysettings.xml
pyspark version:  3.5.0
Spark Version:  3.5.0
READ_PATH:  /data/crm_with_event_time/header/header_20230228.csv
WRITE_PATH:  /data/delta/landing/header/
AFTER TRANSFORM PHASE:
+-------------+-----------------+--------------+-----------+----------+----------+--------------------+-----------------+-------------+------------+-------------+---------------+-------------------+--------------------------+----------------------------------+-------------------+-------------------+----------+---------------+----------------+--------------+-----------------+--------------------+
|contratto_cod|codice_ordine_sap|tipo_contratto|codice_opec|data_firma|net_amount|causale_annullamento|data_annullamento|codice_agente|status_quote|creazione_dta|closed_by_batch|source_file        |ingest_ts                 |batch_id                          |valid_from_ts      |valid_to_ts        |is_current|valid_from_year|valid_from_month|valid_from_day|creazione_dta_raw|creazione_dta_parsed|
+-------------+-----------------+--------------+-----------+----------+----------+--------------------+-----------------+-------------+------------+-------------+---------------+-------------------+--------------------------+----------------------------------+-------------------+-------------------+----------+---------------+----------------+--------------+-----------------+--------------------+
|C00000136    |3000000136       |366           |OPEC0136   |2022-04-15|32912.9   |NULL                |NULL             |10136        |Pending     |2023-02-03   |NULL           |header_20230228.csv|2025-09-01 13:03:09.195838|20250901130309_header_20230228.csv|2023-02-28 08:07:32|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-03       |2023-02-03          |
|C00000153    |3000000153       |400           |OPEC0153   |2022-07-17|10869.42  |NULL                |NULL             |10153        |Pending     |2023-01-30   |NULL           |header_20230228.csv|2025-09-01 13:03:09.195838|20250901130309_header_20230228.csv|2023-02-28 12:26:39|2023-02-28 17:36:21|false     |2023           |2               |28            |2023-01-30       |2023-01-30          |
|C00000153    |3000000153       |400           |OPEC0153   |2022-03-24|35294.68  |NULL                |NULL             |10153        |Pending     |2023-02-19   |NULL           |header_20230228.csv|2025-09-01 13:03:09.195838|20250901130309_header_20230228.csv|2023-02-28 17:36:21|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-19       |2023-02-19          |
|C00000227    |3000000227       |366           |OPEC0227   |2022-09-16|1995.39   |NULL                |NULL             |10227        |Rejected    |2023-02-03   |NULL           |header_20230228.csv|2025-09-01 13:03:09.195838|20250901130309_header_20230228.csv|2023-02-28 01:43:10|2023-02-28 22:49:11|false     |2023           |2               |28            |2023-02-03       |2023-02-03          |
|C00000227    |3000000227       |365           |OPEC0227   |2022-06-26|18021.16  |NULL                |NULL             |10227        |Rejected    |2023-02-28   |NULL           |header_20230228.csv|2025-09-01 13:03:09.195838|20250901130309_header_20230228.csv|2023-02-28 22:49:11|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-28       |2023-02-28          |
|C00000274    |3000000274       |366           |OPEC0274   |2022-04-10|34361.21  |NULL                |NULL             |10274        |Accepted    |2023-02-05   |NULL           |header_20230228.csv|2025-09-01 13:03:09.195838|20250901130309_header_20230228.csv|2023-02-28 22:15:46|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-05       |2023-02-05          |
|C00000336    |3000000336       |400           |OPEC0336   |2022-03-06|29091.94  |NULL                |NULL             |10336        |Pending     |2023-02-23   |NULL           |header_20230228.csv|2025-09-01 13:03:09.195838|20250901130309_header_20230228.csv|2023-02-28 20:29:39|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-23       |2023-02-23          |
|C00000532    |3000000532       |366           |OPEC0532   |2022-11-06|14529.99  |NULL                |NULL             |10032        |Pending     |2023-02-03   |NULL           |header_20230228.csv|2025-09-01 13:03:09.195838|20250901130309_header_20230228.csv|2023-02-28 21:12:18|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-03       |2023-02-03          |
|C00000549    |3000000549       |366           |OPEC0549   |2023-02-27|44837.0   |NULL                |NULL             |10049        |Pending     |2023-02-10   |NULL           |header_20230228.csv|2025-09-01 13:03:09.195838|20250901130309_header_20230228.csv|2023-02-28 09:53:10|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-10       |2023-02-10          |
|C00000639    |3000000639       |366           |OPEC0639   |2022-12-10|38812.04  |NULL                |NULL             |10139        |Accepted    |2023-02-03   |NULL           |header_20230228.csv|2025-09-01 13:03:09.195838|20250901130309_header_20230228.csv|2023-02-28 03:22:41|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-03       |2023-02-03          |
|C00000691    |3000000691       |400           |OPEC0691   |2022-12-15|9540.58   |NULL                |NULL             |10191        |Rejected    |2023-02-09   |NULL           |header_20230228.csv|2025-09-01 13:03:09.195838|20250901130309_header_20230228.csv|2023-02-28 17:32:28|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-09       |2023-02-09          |
|C00000772    |3000000772       |400           |OPEC0772   |2022-11-13|22784.59  |NULL                |NULL             |10272        |Rejected    |2023-02-16   |NULL           |header_20230228.csv|2025-09-01 13:03:09.195838|20250901130309_header_20230228.csv|2023-02-28 08:51:00|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-16       |2023-02-16          |
|C00000806    |3000000806       |365           |OPEC0806   |2023-01-28|2808.29   |NULL                |NULL             |10306        |Accepted    |2023-02-07   |NULL           |header_20230228.csv|2025-09-01 13:03:09.195838|20250901130309_header_20230228.csv|2023-02-28 18:25:30|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-07       |2023-02-07          |
|C00000873    |3000000873       |400           |OPEC0873   |2022-05-19|26595.38  |NULL                |NULL             |10373        |Pending     |2023-02-04   |NULL           |header_20230228.csv|2025-09-01 13:03:09.195838|20250901130309_header_20230228.csv|2023-02-28 22:02:27|2023-02-28 22:41:37|false     |2023           |2               |28            |2023-02-04       |2023-02-04          |
|C00000873    |3000000873       |365           |OPEC0873   |2023-01-18|11053.96  |NULL                |NULL             |10373        |Rejected    |2023-02-13   |NULL           |header_20230228.csv|2025-09-01 13:03:09.195838|20250901130309_header_20230228.csv|2023-02-28 22:41:37|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-13       |2023-02-13          |
|C00000915    |3000000915       |366           |OPEC0915   |2022-06-09|11462.86  |NULL                |NULL             |10415        |Rejected    |2023-02-08   |NULL           |header_20230228.csv|2025-09-01 13:03:09.195838|20250901130309_header_20230228.csv|2023-02-28 21:09:09|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-08       |2023-02-08          |
|C00000972    |3000000972       |365           |OPEC0972   |2023-02-11|20746.57  |NULL                |NULL             |10472        |Pending     |2023-02-14   |NULL           |header_20230228.csv|2025-09-01 13:03:09.195838|20250901130309_header_20230228.csv|2023-02-28 08:19:42|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-14       |2023-02-14          |
|C00001081    |3000001081       |365           |OPEC0081   |2022-06-10|36043.95  |NULL                |NULL             |10081        |Pending     |2023-02-04   |NULL           |header_20230228.csv|2025-09-01 13:03:09.195838|20250901130309_header_20230228.csv|2023-02-28 06:53:06|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-04       |2023-02-04          |
|C00001100    |3000001100       |365           |OPEC0100   |2022-12-15|39100.62  |NULL                |NULL             |10100        |Pending     |2023-02-26   |NULL           |header_20230228.csv|2025-09-01 13:03:09.195838|20250901130309_header_20230228.csv|2023-02-28 11:11:26|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-26       |2023-02-26          |
|C00001133    |3000001133       |366           |OPEC0133   |2022-12-17|35581.51  |NULL                |NULL             |10133        |Rejected    |2023-02-22   |NULL           |header_20230228.csv|2025-09-01 13:03:09.195838|20250901130309_header_20230228.csv|2023-02-28 13:28:17|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-22       |2023-02-22          |
+-------------+-----------------+--------------+-----------+----------+----------+--------------------+-----------------+-------------+------------+-------------+---------------+-------------------+--------------------------+----------------------------------+-------------------+-------------------+----------+---------------+----------------+--------------+-----------------+--------------------+
only showing top 20 rows

FOUND DELTA TABLE APPLYING MERGING
+-------------+-----------------+--------------+-----------+----------+----------+--------------------+-----------------+-------------+------------+-------------+----------------------------------+-------------------+--------------------------+----------------------------------+-------------------+-------------------+----------+---------------+----------------+--------------+-----------------+--------------------+
|contratto_cod|codice_ordine_sap|tipo_contratto|codice_opec|data_firma|net_amount|causale_annullamento|data_annullamento|codice_agente|status_quote|creazione_dta|closed_by_batch                   |source_file        |ingest_ts                 |batch_id                          |valid_from_ts      |valid_to_ts        |is_current|valid_from_year|valid_from_month|valid_from_day|creazione_dta_raw|creazione_dta_parsed|
+-------------+-----------------+--------------+-----------+----------+----------+--------------------+-----------------+-------------+------------+-------------+----------------------------------+-------------------+--------------------------+----------------------------------+-------------------+-------------------+----------+---------------+----------------+--------------+-----------------+--------------------+
|C00000028    |3000000028       |366           |OPEC0028   |2022-05-08|23122.82  |NULL                |NULL             |10028        |Accepted    |2023-01-20   |NULL                              |header_20230127.csv|2025-09-01 13:02:41.571105|20250901130241_header_20230127.csv|2023-01-27 10:04:21|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-20       |2023-01-20          |
|C00355324    |3000355324       |400           |OPEC0324   |2022-07-19|12181.1   |NULL                |NULL             |10324        |Rejected    |2023-01-05   |NULL                              |header_20230127.csv|2025-09-01 13:02:41.571105|20250901130241_header_20230127.csv|2023-01-27 02:10:49|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-05       |2023-01-05          |
|C00000051    |3000000051       |400           |OPEC0051   |2023-01-23|33725.3   |NULL                |NULL             |10051        |Pending     |2023-01-18   |NULL                              |header_20230127.csv|2025-09-01 13:02:41.571105|20250901130241_header_20230127.csv|2023-01-27 19:59:42|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-18       |2023-01-18          |
|C00355336    |3000355336       |365           |OPEC0336   |2022-12-09|28958.72  |NULL                |NULL             |10336        |Rejected    |2022-12-28   |20250901130254_header_20230228.csv|header_20230127.csv|2025-09-01 13:02:41.571105|20250901130241_header_20230127.csv|2023-01-27 17:01:24|2023-02-28 19:17:37|false     |2023           |1               |27            |2022-12-28       |2022-12-28          |
|C00000067    |3000000067       |365           |OPEC0067   |2022-03-28|22293.62  |NULL                |NULL             |10067        |Pending     |2023-01-02   |NULL                              |header_20230127.csv|2025-09-01 13:02:41.571105|20250901130241_header_20230127.csv|2023-01-27 00:20:27|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-02       |2023-01-02          |
|C00355340    |3000355340       |400           |OPEC0340   |2022-10-07|29525.25  |NULL                |NULL             |10340        |Pending     |2023-01-12   |NULL                              |header_20230127.csv|2025-09-01 13:02:41.571105|20250901130241_header_20230127.csv|2023-01-27 05:42:36|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-12       |2023-01-12          |
|C00000125    |3000000125       |400           |OPEC0125   |2022-02-10|3626.84   |NULL                |NULL             |10125        |Accepted    |2023-01-02   |NULL                              |header_20230127.csv|2025-09-01 13:02:41.571105|20250901130241_header_20230127.csv|2023-01-27 17:36:19|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-02       |2023-01-02          |
|C00355417    |3000355417       |400           |OPEC0417   |2022-04-18|41762.24  |NULL                |NULL             |10417        |Pending     |2023-01-21   |NULL                              |header_20230127.csv|2025-09-01 13:02:41.571105|20250901130241_header_20230127.csv|2023-01-27 10:05:51|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-21       |2023-01-21          |
|C00000136    |3000000136       |400           |OPEC0136   |2022-04-26|25195.97  |NULL                |NULL             |10136        |Accepted    |2023-01-08   |20250901130254_header_20230228.csv|header_20230127.csv|2025-09-01 13:02:41.571105|20250901130241_header_20230127.csv|2023-01-27 07:02:56|2023-02-28 08:07:32|false     |2023           |1               |27            |2023-01-08       |2023-01-08          |
|C00355439    |3000355439       |366           |OPEC0439   |2022-07-28|42491.84  |NULL                |NULL             |10439        |Accepted    |2023-01-10   |NULL                              |header_20230127.csv|2025-09-01 13:02:41.571105|20250901130241_header_20230127.csv|2023-01-27 11:35:36|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-10       |2023-01-10          |
|C00000153    |3000000153       |400           |OPEC0153   |2022-02-24|24992.38  |NULL                |NULL             |10153        |Accepted    |2023-01-13   |20250901130254_header_20230228.csv|header_20230127.csv|2025-09-01 13:02:41.571105|20250901130241_header_20230127.csv|2023-01-27 17:34:30|2023-02-28 12:26:39|false     |2023           |1               |27            |2023-01-13       |2023-01-13          |
|C00355505    |3000355505       |400           |OPEC0505   |2022-11-10|39076.89  |NULL                |NULL             |10005        |Rejected    |2023-01-15   |NULL                              |header_20230127.csv|2025-09-01 13:02:41.571105|20250901130241_header_20230127.csv|2023-01-27 21:24:58|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-15       |2023-01-15          |
|C00000162    |3000000162       |400           |OPEC0162   |2022-09-02|49873.87  |NULL                |NULL             |10162        |Pending     |2023-01-25   |NULL                              |header_20230127.csv|2025-09-01 13:02:41.571105|20250901130241_header_20230127.csv|2023-01-27 19:27:06|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-25       |2023-01-25          |
|C00355518    |3000355518       |365           |OPEC0518   |2022-05-25|37316.46  |NULL                |NULL             |10018        |Accepted    |2022-12-30   |NULL                              |header_20230127.csv|2025-09-01 13:02:41.571105|20250901130241_header_20230127.csv|2023-01-27 13:11:02|9999-12-31 00:00:00|true      |2023           |1               |27            |2022-12-30       |2022-12-30          |
|C00000183    |3000000183       |365           |OPEC0183   |2022-05-31|2226.21   |NULL                |NULL             |10183        |Pending     |2023-01-17   |NULL                              |header_20230127.csv|2025-09-01 13:02:41.571105|20250901130241_header_20230127.csv|2023-01-27 20:58:39|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-17       |2023-01-17          |
|C00355536    |3000355536       |365           |OPEC0536   |2022-10-25|3882.9    |NULL                |NULL             |10036        |Rejected    |2023-01-19   |NULL                              |header_20230127.csv|2025-09-01 13:02:41.571105|20250901130241_header_20230127.csv|2023-01-27 16:57:42|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-19       |2023-01-19          |
|C00000227    |3000000227       |366           |OPEC0227   |2022-11-30|20846.58  |NULL                |NULL             |10227        |Rejected    |2023-01-22   |NULL                              |header_20230127.csv|2025-09-01 13:02:41.571105|20250901130241_header_20230127.csv|2023-01-27 12:51:39|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-22       |2023-01-22          |
|C00355550    |3000355550       |365           |OPEC0550   |2022-04-16|33179.63  |NULL                |NULL             |10050        |Accepted    |2023-01-10   |NULL                              |header_20230127.csv|2025-09-01 13:02:41.571105|20250901130241_header_20230127.csv|2023-01-27 03:25:34|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-10       |2023-01-10          |
|C00000254    |3000000254       |400           |OPEC0254   |2022-09-04|37867.17  |NULL                |NULL             |10254        |Rejected    |2023-01-20   |NULL                              |header_20230127.csv|2025-09-01 13:02:41.571105|20250901130241_header_20230127.csv|2023-01-27 13:34:15|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-20       |2023-01-20          |
|C00355590    |3000355590       |366           |OPEC0590   |2022-07-15|43008.8   |NULL                |NULL             |10090        |Accepted    |2023-01-01   |NULL                              |header_20230127.csv|2025-09-01 13:02:41.571105|20250901130241_header_20230127.csv|2023-01-27 19:37:16|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-01       |2023-01-01          |
+-------------+-----------------+--------------+-----------+----------+----------+--------------------+-----------------+-------------+------------+-------------+----------------------------------+-------------------+--------------------------+----------------------------------+-------------------+-------------------+----------+---------------+----------------+--------------+-----------------+--------------------+
only showing top 20 rows

inserted_count:  0
closed_count:  261795
MERGE COMPLETATO (intraday versions gestite).
