:: loading settings :: url = jar:file:/opt/spark-3.5.0-bin-hadoop3/jars/ivy-2.5.1.jar!/org/apache/ivy/core/settings/ivysettings.xml
pyspark version:  3.5.0
Spark Version:  3.5.0
READ_PATH:  /data/crm_with_event_time/header/header_20230228.csv
WRITE_PATH:  /data/delta/landing/header/
AFTER TRANSFORM PHASE:
+-------------+-----------------+--------------+-----------+----------+----------+--------------------+-----------------+-------------+------------+-------------+---------------+-------------------+--------------------------+----------------------------------+-------------------+-------------------+----------+---------------+----------------+--------------+-----------------+--------------------+
|contratto_cod|codice_ordine_sap|tipo_contratto|codice_opec|data_firma|net_amount|causale_annullamento|data_annullamento|codice_agente|status_quote|creazione_dta|closed_by_batch|source_file        |ingest_ts                 |batch_id                          |valid_from_ts      |valid_to_ts        |is_current|valid_from_year|valid_from_month|valid_from_day|creazione_dta_raw|creazione_dta_parsed|
+-------------+-----------------+--------------+-----------+----------+----------+--------------------+-----------------+-------------+------------+-------------+---------------+-------------------+--------------------------+----------------------------------+-------------------+-------------------+----------+---------------+----------------+--------------+-----------------+--------------------+
|C00000133    |3000000133       |365           |OPEC0133   |2022-10-11|6642.29   |NULL                |NULL             |10133        |Accepted    |2023-02-04   |NULL           |header_20230228.csv|2025-09-01 13:04:57.242813|20250901130457_header_20230228.csv|2023-02-28 13:23:00|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-04       |2023-02-04          |
|C00000136    |3000000136       |366           |OPEC0136   |2022-04-15|32912.9   |NULL                |NULL             |10136        |Pending     |2023-02-03   |NULL           |header_20230228.csv|2025-09-01 13:04:57.242813|20250901130457_header_20230228.csv|2023-02-28 08:07:32|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-03       |2023-02-03          |
|C00000153    |3000000153       |400           |OPEC0153   |2022-07-17|10869.42  |NULL                |NULL             |10153        |Pending     |2023-01-30   |NULL           |header_20230228.csv|2025-09-01 13:04:57.242813|20250901130457_header_20230228.csv|2023-02-28 12:26:39|2023-02-28 17:36:21|false     |2023           |2               |28            |2023-01-30       |2023-01-30          |
|C00000153    |3000000153       |400           |OPEC0153   |2022-03-24|35294.68  |NULL                |NULL             |10153        |Pending     |2023-02-19   |NULL           |header_20230228.csv|2025-09-01 13:04:57.242813|20250901130457_header_20230228.csv|2023-02-28 17:36:21|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-19       |2023-02-19          |
|C00000191    |3000000191       |400           |OPEC0191   |2022-06-11|36205.81  |NULL                |NULL             |10191        |Rejected    |2023-01-31   |NULL           |header_20230228.csv|2025-09-01 13:04:57.242813|20250901130457_header_20230228.csv|2023-02-28 06:23:49|2023-02-28 14:46:23|false     |2023           |2               |28            |2023-01-31       |2023-01-31          |
|C00000191    |3000000191       |400           |OPEC0191   |2022-10-30|28580.18  |NULL                |NULL             |10191        |Pending     |2023-02-09   |NULL           |header_20230228.csv|2025-09-01 13:04:57.242813|20250901130457_header_20230228.csv|2023-02-28 14:46:23|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-09       |2023-02-09          |
|C00000203    |3000000203       |366           |OPEC0203   |2022-05-10|48539.35  |NULL                |NULL             |10203        |Accepted    |2023-02-09   |NULL           |header_20230228.csv|2025-09-01 13:04:57.242813|20250901130457_header_20230228.csv|2023-02-28 03:48:48|2023-02-28 16:48:05|false     |2023           |2               |28            |2023-02-09       |2023-02-09          |
|C00000203    |3000000203       |366           |OPEC0203   |2022-08-02|9841.1    |NULL                |NULL             |10203        |Rejected    |2023-02-02   |NULL           |header_20230228.csv|2025-09-01 13:04:57.242813|20250901130457_header_20230228.csv|2023-02-28 16:48:05|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-02       |2023-02-02          |
|C00000206    |3000000206       |366           |OPEC0206   |2022-12-31|20567.73  |NULL                |NULL             |10206        |Rejected    |2023-02-12   |NULL           |header_20230228.csv|2025-09-01 13:04:57.242813|20250901130457_header_20230228.csv|2023-02-28 13:34:41|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-12       |2023-02-12          |
|C00000227    |3000000227       |366           |OPEC0227   |2022-09-16|1995.39   |NULL                |NULL             |10227        |Rejected    |2023-02-03   |NULL           |header_20230228.csv|2025-09-01 13:04:57.242813|20250901130457_header_20230228.csv|2023-02-28 01:43:10|2023-02-28 22:49:11|false     |2023           |2               |28            |2023-02-03       |2023-02-03          |
|C00000227    |3000000227       |365           |OPEC0227   |2022-06-26|18021.16  |NULL                |NULL             |10227        |Rejected    |2023-02-28   |NULL           |header_20230228.csv|2025-09-01 13:04:57.242813|20250901130457_header_20230228.csv|2023-02-28 22:49:11|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-28       |2023-02-28          |
|C00000233    |3000000233       |365           |OPEC0233   |2022-04-29|31521.06  |NULL                |NULL             |10233        |Accepted    |2023-02-23   |NULL           |header_20230228.csv|2025-09-01 13:04:57.242813|20250901130457_header_20230228.csv|2023-02-28 12:22:31|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-23       |2023-02-23          |
|C00000262    |3000000262       |365           |OPEC0262   |2022-03-26|36460.18  |NULL                |NULL             |10262        |Rejected    |2023-02-20   |NULL           |header_20230228.csv|2025-09-01 13:04:57.242813|20250901130457_header_20230228.csv|2023-02-28 15:23:23|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-20       |2023-02-20          |
|C00000274    |3000000274       |366           |OPEC0274   |2022-04-10|34361.21  |NULL                |NULL             |10274        |Accepted    |2023-02-05   |NULL           |header_20230228.csv|2025-09-01 13:04:57.242813|20250901130457_header_20230228.csv|2023-02-28 22:15:46|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-05       |2023-02-05          |
|C00000302    |3000000302       |366           |OPEC0302   |2022-05-31|25536.8   |NULL                |NULL             |10302        |Pending     |2023-02-23   |NULL           |header_20230228.csv|2025-09-01 13:04:57.242813|20250901130457_header_20230228.csv|2023-02-28 13:58:04|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-23       |2023-02-23          |
|C00000315    |3000000315       |366           |OPEC0315   |2022-12-21|16627.64  |NULL                |NULL             |10315        |Pending     |2023-02-24   |NULL           |header_20230228.csv|2025-09-01 13:04:57.242813|20250901130457_header_20230228.csv|2023-02-28 00:02:51|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-24       |2023-02-24          |
|C00000336    |3000000336       |400           |OPEC0336   |2022-03-06|29091.94  |NULL                |NULL             |10336        |Pending     |2023-02-23   |NULL           |header_20230228.csv|2025-09-01 13:04:57.242813|20250901130457_header_20230228.csv|2023-02-28 20:29:39|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-23       |2023-02-23          |
|C00000339    |3000000339       |365           |OPEC0339   |2022-10-21|2590.85   |NULL                |NULL             |10339        |Pending     |2023-02-26   |NULL           |header_20230228.csv|2025-09-01 13:04:57.242813|20250901130457_header_20230228.csv|2023-02-28 21:54:15|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-26       |2023-02-26          |
|C00000509    |3000000509       |365           |OPEC0509   |2022-08-12|44646.42  |NULL                |NULL             |10009        |Accepted    |2023-02-04   |NULL           |header_20230228.csv|2025-09-01 13:04:57.242813|20250901130457_header_20230228.csv|2023-02-28 05:45:05|2023-02-28 09:30:37|false     |2023           |2               |28            |2023-02-04       |2023-02-04          |
|C00000509    |3000000509       |366           |OPEC0509   |2022-06-23|41335.76  |NULL                |NULL             |10009        |Rejected    |2023-02-17   |NULL           |header_20230228.csv|2025-09-01 13:04:57.242813|20250901130457_header_20230228.csv|2023-02-28 09:30:37|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-17       |2023-02-17          |
+-------------+-----------------+--------------+-----------+----------+----------+--------------------+-----------------+-------------+------------+-------------+---------------+-------------------+--------------------------+----------------------------------+-------------------+-------------------+----------+---------------+----------------+--------------+-----------------+--------------------+
only showing top 20 rows

FOUND DELTA TABLE APPLYING MERGING
+-------------+-----------------+--------------+-----------+----------+----------+--------------------+-----------------+-------------+------------+-------------+----------------------------------+-------------------+--------------------------+----------------------------------+-------------------+-------------------+----------+---------------+----------------+--------------+-----------------+--------------------+
|contratto_cod|codice_ordine_sap|tipo_contratto|codice_opec|data_firma|net_amount|causale_annullamento|data_annullamento|codice_agente|status_quote|creazione_dta|closed_by_batch                   |source_file        |ingest_ts                 |batch_id                          |valid_from_ts      |valid_to_ts        |is_current|valid_from_year|valid_from_month|valid_from_day|creazione_dta_raw|creazione_dta_parsed|
+-------------+-----------------+--------------+-----------+----------+----------+--------------------+-----------------+-------------+------------+-------------+----------------------------------+-------------------+--------------------------+----------------------------------+-------------------+-------------------+----------+---------------+----------------+--------------+-----------------+--------------------+
|C00000001    |3000000001       |400           |OPEC0001   |2022-04-23|5260.0    |NULL                |NULL             |10001        |Rejected    |2023-01-26   |NULL                              |header_20230127.csv|2025-09-01 13:04:30.396223|20250901130430_header_20230127.csv|2023-01-27 02:01:05|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-26       |2023-01-26          |
|C00845309    |3000845309       |366           |OPEC0309   |2022-08-12|38197.5   |NULL                |NULL             |10309        |Accepted    |2023-01-23   |NULL                              |header_20230127.csv|2025-09-01 13:04:30.396223|20250901130430_header_20230127.csv|2023-01-27 04:06:56|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-23       |2023-01-23          |
|C00000005    |3000000005       |365           |OPEC0005   |2022-12-11|19616.44  |NULL                |NULL             |10005        |Rejected    |2022-12-31   |20250901130441_header_20230228.csv|header_20230127.csv|2025-09-01 13:04:30.396223|20250901130430_header_20230127.csv|2023-01-27 09:22:38|2023-02-28 10:02:25|false     |2023           |1               |27            |2022-12-31       |2022-12-31          |
|C00845316    |3000845316       |366           |OPEC0316   |2022-09-02|31617.47  |NULL                |NULL             |10316        |Rejected    |2023-01-11   |NULL                              |header_20230127.csv|2025-09-01 13:04:30.396223|20250901130430_header_20230127.csv|2023-01-27 08:50:26|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-11       |2023-01-11          |
|C00000007    |3000000007       |400           |OPEC0007   |2022-07-26|29290.26  |NULL                |NULL             |10007        |Pending     |2023-01-25   |NULL                              |header_20230127.csv|2025-09-01 13:04:30.396223|20250901130430_header_20230127.csv|2023-01-27 19:02:42|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-25       |2023-01-25          |
|C00845330    |3000845330       |400           |OPEC0330   |2022-06-17|13195.5   |NULL                |NULL             |10330        |Accepted    |2023-01-27   |NULL                              |header_20230127.csv|2025-09-01 13:04:30.396223|20250901130430_header_20230127.csv|2023-01-27 12:48:52|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-27       |2023-01-27          |
|C00000008    |3000000008       |366           |OPEC0008   |2022-12-18|42910.57  |NULL                |NULL             |10008        |Accepted    |2023-01-15   |NULL                              |header_20230127.csv|2025-09-01 13:04:30.396223|20250901130430_header_20230127.csv|2023-01-27 06:17:29|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-15       |2023-01-15          |
|C00845336    |3000845336       |400           |OPEC0336   |2022-07-27|37728.72  |NULL                |NULL             |10336        |Rejected    |2023-01-16   |20250901130441_header_20230228.csv|header_20230127.csv|2025-09-01 13:04:30.396223|20250901130430_header_20230127.csv|2023-01-27 02:08:35|2023-02-28 06:32:21|false     |2023           |1               |27            |2023-01-16       |2023-01-16          |
|C00000017    |3000000017       |365           |OPEC0017   |2022-11-10|31744.86  |NULL                |NULL             |10017        |Pending     |2023-01-14   |20250901130441_header_20230228.csv|header_20230127.csv|2025-09-01 13:04:30.396223|20250901130430_header_20230127.csv|2023-01-27 00:38:04|2023-02-28 04:59:34|false     |2023           |1               |27            |2023-01-14       |2023-01-14          |
|C00845341    |3000845341       |365           |OPEC0341   |2023-01-26|22089.05  |NULL                |NULL             |10341        |Pending     |2023-01-26   |NULL                              |header_20230127.csv|2025-09-01 13:04:30.396223|20250901130430_header_20230127.csv|2023-01-27 11:03:41|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-26       |2023-01-26          |
|C00000020    |3000000020       |366           |OPEC0020   |2022-12-01|15381.51  |NULL                |NULL             |10020        |Accepted    |2023-01-13   |NULL                              |header_20230127.csv|2025-09-01 13:04:30.396223|20250901130430_header_20230127.csv|2023-01-27 19:00:46|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-13       |2023-01-13          |
|C00845351    |3000845351       |400           |OPEC0351   |2022-06-28|14399.24  |NULL                |NULL             |10351        |Accepted    |2023-01-09   |NULL                              |header_20230127.csv|2025-09-01 13:04:30.396223|20250901130430_header_20230127.csv|2023-01-27 01:23:54|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-09       |2023-01-09          |
|C00000023    |3000000023       |400           |OPEC0023   |2022-05-01|46006.18  |NULL                |NULL             |10023        |Pending     |2023-01-17   |NULL                              |header_20230127.csv|2025-09-01 13:04:30.396223|20250901130430_header_20230127.csv|2023-01-27 04:31:01|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-17       |2023-01-17          |
|C00845370    |3000845370       |366           |OPEC0370   |2022-11-23|30116.06  |NULL                |NULL             |10370        |Pending     |2023-01-10   |NULL                              |header_20230127.csv|2025-09-01 13:04:30.396223|20250901130430_header_20230127.csv|2023-01-27 15:51:37|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-10       |2023-01-10          |
|C00000082    |3000000082       |366           |OPEC0082   |2022-10-07|9618.45   |NULL                |NULL             |10082        |Pending     |2023-01-11   |20250901130441_header_20230228.csv|header_20230127.csv|2025-09-01 13:04:30.396223|20250901130430_header_20230127.csv|2023-01-27 02:29:03|2023-02-28 15:49:24|false     |2023           |1               |27            |2023-01-11       |2023-01-11          |
|C00845380    |3000845380       |400           |OPEC0380   |2022-07-23|26309.36  |NULL                |NULL             |10380        |Pending     |2023-01-21   |NULL                              |header_20230127.csv|2025-09-01 13:04:30.396223|20250901130430_header_20230127.csv|2023-01-27 00:05:08|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-21       |2023-01-21          |
|C00000099    |3000000099       |365           |OPEC0099   |2023-01-12|47530.97  |NULL                |NULL             |10099        |Accepted    |2023-01-01   |20250901130441_header_20230228.csv|header_20230127.csv|2025-09-01 13:04:30.396223|20250901130430_header_20230127.csv|2023-01-27 19:01:39|2023-02-28 09:57:20|false     |2023           |1               |27            |2023-01-01       |2023-01-01          |
|C00845409    |3000845409       |400           |OPEC0409   |2023-01-06|21818.63  |NULL                |NULL             |10409        |Accepted    |2023-01-17   |20250901130441_header_20230228.csv|header_20230127.csv|2025-09-01 13:04:30.396223|20250901130430_header_20230127.csv|2023-01-27 19:08:32|2023-02-28 01:58:36|false     |2023           |1               |27            |2023-01-17       |2023-01-17          |
|C00000101    |3000000101       |366           |OPEC0101   |2022-07-23|9221.67   |NULL                |NULL             |10101        |Pending     |2022-12-28   |20250901130441_header_20230228.csv|header_20230127.csv|2025-09-01 13:04:30.396223|20250901130430_header_20230127.csv|2023-01-27 21:47:45|2023-02-28 04:01:26|false     |2023           |1               |27            |2022-12-28       |2022-12-28          |
|C00845413    |3000845413       |400           |OPEC0413   |2022-04-20|22961.34  |NULL                |NULL             |10413        |Pending     |2022-12-31   |NULL                              |header_20230127.csv|2025-09-01 13:04:30.396223|20250901130430_header_20230127.csv|2023-01-27 13:48:38|9999-12-31 00:00:00|true      |2023           |1               |27            |2022-12-31       |2022-12-31          |
+-------------+-----------------+--------------+-----------+----------+----------+--------------------+-----------------+-------------+------------+-------------+----------------------------------+-------------------+--------------------------+----------------------------------+-------------------+-------------------+----------+---------------+----------------+--------------+-----------------+--------------------+
only showing top 20 rows

inserted_count:  0
closed_count:  261794
MERGE COMPLETATO (intraday versions gestite).
