:: loading settings :: url = jar:file:/opt/spark-3.5.0-bin-hadoop3/jars/ivy-2.5.1.jar!/org/apache/ivy/core/settings/ivysettings.xml
pyspark version:  3.5.0
Spark Version:  3.5.0
READ_PATH:  /data/crm_with_event_time/header/header_20230228.csv
WRITE_PATH:  /data/delta/landing/header/
AFTER TRANSFORM PHASE:
+-------------+-----------------+--------------+-----------+----------+----------+--------------------+-----------------+-------------+------------+-------------+---------------+-------------------+--------------------------+----------------------------------+-------------------+-------------------+----------+---------------+----------------+--------------+-----------------+--------------------+
|contratto_cod|codice_ordine_sap|tipo_contratto|codice_opec|data_firma|net_amount|causale_annullamento|data_annullamento|codice_agente|status_quote|creazione_dta|closed_by_batch|source_file        |ingest_ts                 |batch_id                          |valid_from_ts      |valid_to_ts        |is_current|valid_from_year|valid_from_month|valid_from_day|creazione_dta_raw|creazione_dta_parsed|
+-------------+-----------------+--------------+-----------+----------+----------+--------------------+-----------------+-------------+------------+-------------+---------------+-------------------+--------------------------+----------------------------------+-------------------+-------------------+----------+---------------+----------------+--------------+-----------------+--------------------+
|C00000005    |3000000005       |365           |OPEC0005   |2022-11-13|46438.18  |NULL                |NULL             |10005        |Accepted    |2023-02-03   |NULL           |header_20230228.csv|2025-09-01 13:06:57.864996|20250901130657_header_20230228.csv|2023-02-28 10:02:25|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-03       |2023-02-03          |
|C00000017    |3000000017       |400           |OPEC0017   |2023-01-06|25131.23  |NULL                |NULL             |10017        |Rejected    |2023-02-13   |NULL           |header_20230228.csv|2025-09-01 13:06:57.864996|20250901130657_header_20230228.csv|2023-02-28 04:59:34|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-13       |2023-02-13          |
|C00000025    |3000000025       |400           |OPEC0025   |2022-07-06|25064.26  |NULL                |NULL             |10025        |Accepted    |2023-02-12   |NULL           |header_20230228.csv|2025-09-01 13:06:57.864996|20250901130657_header_20230228.csv|2023-02-28 05:59:49|2023-02-28 09:20:48|false     |2023           |2               |28            |2023-02-12       |2023-02-12          |
|C00000025    |3000000025       |400           |OPEC0025   |2022-06-07|35703.71  |NULL                |NULL             |10025        |Rejected    |2023-02-06   |NULL           |header_20230228.csv|2025-09-01 13:06:57.864996|20250901130657_header_20230228.csv|2023-02-28 09:20:48|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-06       |2023-02-06          |
|C00000041    |3000000041       |366           |OPEC0041   |2022-05-31|43372.99  |NULL                |NULL             |10041        |Rejected    |2023-02-10   |NULL           |header_20230228.csv|2025-09-01 13:06:57.864996|20250901130657_header_20230228.csv|2023-02-28 09:22:28|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-10       |2023-02-10          |
|C00000082    |3000000082       |366           |OPEC0082   |2022-04-09|18111.26  |NULL                |NULL             |10082        |Rejected    |2023-01-30   |NULL           |header_20230228.csv|2025-09-01 13:06:57.864996|20250901130657_header_20230228.csv|2023-02-28 15:49:24|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-01-30       |2023-01-30          |
|C00000083    |3000000083       |400           |OPEC0083   |2022-08-03|28943.01  |NULL                |NULL             |10083        |Rejected    |2023-02-08   |NULL           |header_20230228.csv|2025-09-01 13:06:57.864996|20250901130657_header_20230228.csv|2023-02-28 14:18:35|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-08       |2023-02-08          |
|C00000096    |3000000096       |365           |OPEC0096   |2022-11-15|47327.11  |NULL                |NULL             |10096        |Pending     |2023-02-26   |NULL           |header_20230228.csv|2025-09-01 13:06:57.864996|20250901130657_header_20230228.csv|2023-02-28 09:06:44|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-26       |2023-02-26          |
|C00000099    |3000000099       |365           |OPEC0099   |2022-12-10|14853.06  |NULL                |NULL             |10099        |Pending     |2023-02-02   |NULL           |header_20230228.csv|2025-09-01 13:06:57.864996|20250901130657_header_20230228.csv|2023-02-28 09:57:20|2023-02-28 16:26:15|false     |2023           |2               |28            |2023-02-02       |2023-02-02          |
|C00000099    |3000000099       |365           |OPEC0099   |2023-02-19|31385.6   |NULL                |NULL             |10099        |Accepted    |2023-02-06   |NULL           |header_20230228.csv|2025-09-01 13:06:57.864996|20250901130657_header_20230228.csv|2023-02-28 16:26:15|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-06       |2023-02-06          |
|C00000101    |3000000101       |400           |OPEC0101   |2023-02-04|23765.05  |NULL                |NULL             |10101        |Accepted    |2023-02-24   |NULL           |header_20230228.csv|2025-09-01 13:06:57.864996|20250901130657_header_20230228.csv|2023-02-28 04:01:26|2023-02-28 08:04:58|false     |2023           |2               |28            |2023-02-24       |2023-02-24          |
|C00000101    |3000000101       |400           |OPEC0101   |2022-12-03|5785.44   |NULL                |NULL             |10101        |Rejected    |2023-02-20   |NULL           |header_20230228.csv|2025-09-01 13:06:57.864996|20250901130657_header_20230228.csv|2023-02-28 08:04:58|2023-02-28 17:26:04|false     |2023           |2               |28            |2023-02-20       |2023-02-20          |
|C00000101    |3000000101       |400           |OPEC0101   |2022-05-12|24971.0   |NULL                |NULL             |10101        |Accepted    |2023-02-01   |NULL           |header_20230228.csv|2025-09-01 13:06:57.864996|20250901130657_header_20230228.csv|2023-02-28 17:26:04|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-01       |2023-02-01          |
|C00000104    |3000000104       |366           |OPEC0104   |2022-03-13|21410.94  |NULL                |NULL             |10104        |Pending     |2023-01-30   |NULL           |header_20230228.csv|2025-09-01 13:06:57.864996|20250901130657_header_20230228.csv|2023-02-28 17:56:36|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-01-30       |2023-01-30          |
|C00000115    |3000000115       |400           |OPEC0115   |2022-09-04|3069.66   |NULL                |NULL             |10115        |Rejected    |2023-02-05   |NULL           |header_20230228.csv|2025-09-01 13:06:57.864996|20250901130657_header_20230228.csv|2023-02-28 03:52:38|2023-02-28 08:24:28|false     |2023           |2               |28            |2023-02-05       |2023-02-05          |
|C00000115    |3000000115       |365           |OPEC0115   |2022-12-29|46123.06  |NULL                |NULL             |10115        |Accepted    |2023-02-26   |NULL           |header_20230228.csv|2025-09-01 13:06:57.864996|20250901130657_header_20230228.csv|2023-02-28 08:24:28|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-26       |2023-02-26          |
|C00000133    |3000000133       |365           |OPEC0133   |2022-10-11|6642.29   |NULL                |NULL             |10133        |Accepted    |2023-02-04   |NULL           |header_20230228.csv|2025-09-01 13:06:57.864996|20250901130657_header_20230228.csv|2023-02-28 13:23:00|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-04       |2023-02-04          |
|C00000136    |3000000136       |366           |OPEC0136   |2022-04-15|32912.9   |NULL                |NULL             |10136        |Pending     |2023-02-03   |NULL           |header_20230228.csv|2025-09-01 13:06:57.864996|20250901130657_header_20230228.csv|2023-02-28 08:07:32|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-03       |2023-02-03          |
|C00000140    |3000000140       |366           |OPEC0140   |2022-12-09|12345.45  |NULL                |NULL             |10140        |Pending     |2023-02-03   |NULL           |header_20230228.csv|2025-09-01 13:06:57.864996|20250901130657_header_20230228.csv|2023-02-28 21:48:17|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-03       |2023-02-03          |
|C00000141    |3000000141       |366           |OPEC0141   |2023-01-05|27743.22  |NULL                |NULL             |10141        |Accepted    |2023-02-11   |NULL           |header_20230228.csv|2025-09-01 13:06:57.864996|20250901130657_header_20230228.csv|2023-02-28 07:21:11|9999-12-31 00:00:00|true      |2023           |2               |28            |2023-02-11       |2023-02-11          |
+-------------+-----------------+--------------+-----------+----------+----------+--------------------+-----------------+-------------+------------+-------------+---------------+-------------------+--------------------------+----------------------------------+-------------------+-------------------+----------+---------------+----------------+--------------+-----------------+--------------------+
only showing top 20 rows

FOUND DELTA TABLE APPLYING MERGING
+-------------+-----------------+--------------+-----------+----------+----------+--------------------+-----------------+-------------+------------+-------------+----------------------------------+-------------------+--------------------------+----------------------------------+-------------------+-------------------+----------+---------------+----------------+--------------+-----------------+--------------------+
|contratto_cod|codice_ordine_sap|tipo_contratto|codice_opec|data_firma|net_amount|causale_annullamento|data_annullamento|codice_agente|status_quote|creazione_dta|closed_by_batch                   |source_file        |ingest_ts                 |batch_id                          |valid_from_ts      |valid_to_ts        |is_current|valid_from_year|valid_from_month|valid_from_day|creazione_dta_raw|creazione_dta_parsed|
+-------------+-----------------+--------------+-----------+----------+----------+--------------------+-----------------+-------------+------------+-------------+----------------------------------+-------------------+--------------------------+----------------------------------+-------------------+-------------------+----------+---------------+----------------+--------------+-----------------+--------------------+
|C00000001    |3000000001       |400           |OPEC0001   |2022-04-23|5260.0    |NULL                |NULL             |10001        |Rejected    |2023-01-26   |NULL                              |header_20230127.csv|2025-09-01 13:06:22.789861|20250901130622_header_20230127.csv|2023-01-27 02:01:05|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-26       |2023-01-26          |
|C00000003    |3000000003       |400           |OPEC0003   |2022-06-27|11801.59  |NULL                |NULL             |10003        |Pending     |2023-01-19   |NULL                              |header_20230127.csv|2025-09-01 13:06:22.789861|20250901130622_header_20230127.csv|2023-01-27 21:51:55|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-19       |2023-01-19          |
|C00000005    |3000000005       |365           |OPEC0005   |2022-12-11|19616.44  |NULL                |NULL             |10005        |Rejected    |2022-12-31   |20250901130638_header_20230228.csv|header_20230127.csv|2025-09-01 13:06:22.789861|20250901130622_header_20230127.csv|2023-01-27 09:22:38|2023-02-28 10:02:25|false     |2023           |1               |27            |2022-12-31       |2022-12-31          |
|C00000007    |3000000007       |400           |OPEC0007   |2022-07-26|29290.26  |NULL                |NULL             |10007        |Pending     |2023-01-25   |NULL                              |header_20230127.csv|2025-09-01 13:06:22.789861|20250901130622_header_20230127.csv|2023-01-27 19:02:42|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-25       |2023-01-25          |
|C00000008    |3000000008       |366           |OPEC0008   |2022-12-18|42910.57  |NULL                |NULL             |10008        |Accepted    |2023-01-15   |NULL                              |header_20230127.csv|2025-09-01 13:06:22.789861|20250901130622_header_20230127.csv|2023-01-27 06:17:29|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-15       |2023-01-15          |
|C00000017    |3000000017       |365           |OPEC0017   |2022-11-10|31744.86  |NULL                |NULL             |10017        |Pending     |2023-01-14   |20250901130638_header_20230228.csv|header_20230127.csv|2025-09-01 13:06:22.789861|20250901130622_header_20230127.csv|2023-01-27 00:38:04|2023-02-28 04:59:34|false     |2023           |1               |27            |2023-01-14       |2023-01-14          |
|C00000020    |3000000020       |366           |OPEC0020   |2022-12-01|15381.51  |NULL                |NULL             |10020        |Accepted    |2023-01-13   |NULL                              |header_20230127.csv|2025-09-01 13:06:22.789861|20250901130622_header_20230127.csv|2023-01-27 19:00:46|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-13       |2023-01-13          |
|C00000023    |3000000023       |400           |OPEC0023   |2022-05-01|46006.18  |NULL                |NULL             |10023        |Pending     |2023-01-17   |NULL                              |header_20230127.csv|2025-09-01 13:06:22.789861|20250901130622_header_20230127.csv|2023-01-27 04:31:01|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-17       |2023-01-17          |
|C00000025    |3000000025       |400           |OPEC0025   |2022-05-24|40985.14  |NULL                |NULL             |10025        |Pending     |2023-01-03   |20250901130638_header_20230228.csv|header_20230127.csv|2025-09-01 13:06:22.789861|20250901130622_header_20230127.csv|2023-01-27 01:08:08|2023-02-28 05:59:49|false     |2023           |1               |27            |2023-01-03       |2023-01-03          |
|C00000028    |3000000028       |366           |OPEC0028   |2022-05-08|23122.82  |NULL                |NULL             |10028        |Accepted    |2023-01-20   |NULL                              |header_20230127.csv|2025-09-01 13:06:22.789861|20250901130622_header_20230127.csv|2023-01-27 10:04:21|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-20       |2023-01-20          |
|C00000041    |3000000041       |366           |OPEC0041   |2022-11-09|10305.0   |NULL                |NULL             |10041        |Accepted    |2022-12-28   |20250901130638_header_20230228.csv|header_20230127.csv|2025-09-01 13:06:22.789861|20250901130622_header_20230127.csv|2023-01-27 21:03:37|2023-02-28 09:22:28|false     |2023           |1               |27            |2022-12-28       |2022-12-28          |
|C00000048    |3000000048       |365           |OPEC0048   |2023-01-23|23455.99  |NULL                |NULL             |10048        |Pending     |2023-01-24   |NULL                              |header_20230127.csv|2025-09-01 13:06:22.789861|20250901130622_header_20230127.csv|2023-01-27 09:04:34|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-24       |2023-01-24          |
|C00000051    |3000000051       |400           |OPEC0051   |2023-01-23|33725.3   |NULL                |NULL             |10051        |Pending     |2023-01-18   |NULL                              |header_20230127.csv|2025-09-01 13:06:22.789861|20250901130622_header_20230127.csv|2023-01-27 19:59:42|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-18       |2023-01-18          |
|C00000056    |3000000056       |366           |OPEC0056   |2022-04-20|35577.7   |NULL                |NULL             |10056        |Pending     |2023-01-27   |NULL                              |header_20230127.csv|2025-09-01 13:06:22.789861|20250901130622_header_20230127.csv|2023-01-27 22:07:04|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-27       |2023-01-27          |
|C00000064    |3000000064       |365           |OPEC0064   |2023-01-15|33341.63  |NULL                |NULL             |10064        |Rejected    |2023-01-17   |NULL                              |header_20230127.csv|2025-09-01 13:06:22.789861|20250901130622_header_20230127.csv|2023-01-27 06:17:55|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-17       |2023-01-17          |
|C00000067    |3000000067       |365           |OPEC0067   |2022-03-28|22293.62  |NULL                |NULL             |10067        |Pending     |2023-01-02   |NULL                              |header_20230127.csv|2025-09-01 13:06:22.789861|20250901130622_header_20230127.csv|2023-01-27 00:20:27|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-02       |2023-01-02          |
|C00000080    |3000000080       |366           |OPEC0080   |2022-03-11|29207.87  |NULL                |NULL             |10080        |Pending     |2023-01-05   |NULL                              |header_20230127.csv|2025-09-01 13:06:22.789861|20250901130622_header_20230127.csv|2023-01-27 13:24:31|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-05       |2023-01-05          |
|C00000082    |3000000082       |366           |OPEC0082   |2022-10-07|9618.45   |NULL                |NULL             |10082        |Pending     |2023-01-11   |20250901130638_header_20230228.csv|header_20230127.csv|2025-09-01 13:06:22.789861|20250901130622_header_20230127.csv|2023-01-27 02:29:03|2023-02-28 15:49:24|false     |2023           |1               |27            |2023-01-11       |2023-01-11          |
|C00000083    |3000000083       |365           |OPEC0083   |2022-11-26|23366.63  |NULL                |NULL             |10083        |Rejected    |2023-01-06   |NULL                              |header_20230127.csv|2025-09-01 13:06:22.789861|20250901130622_header_20230127.csv|2023-01-27 16:33:35|9999-12-31 00:00:00|true      |2023           |1               |27            |2023-01-06       |2023-01-06          |
|C00000096    |3000000096       |365           |OPEC0096   |2023-01-02|13747.66  |NULL                |NULL             |10096        |Rejected    |2023-01-21   |20250901130638_header_20230228.csv|header_20230127.csv|2025-09-01 13:06:22.789861|20250901130622_header_20230127.csv|2023-01-27 13:29:20|2023-02-28 09:06:44|false     |2023           |1               |27            |2023-01-21       |2023-01-21          |
+-------------+-----------------+--------------+-----------+----------+----------+--------------------+-----------------+-------------+------------+-------------+----------------------------------+-------------------+--------------------------+----------------------------------+-------------------+-------------------+----------+---------------+----------------+--------------+-----------------+--------------------+
only showing top 20 rows

inserted_count:  0
closed_count:  261794
MERGE COMPLETATO (intraday versions gestite).
